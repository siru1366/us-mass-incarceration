---
title: "Delving into the World Inside Prisons for Safety, Health, and Isolation"

author: 
  - Dong Jun Yoon
  - Sirui Tan
thanks: "Code and data are available at: https://github.com/siru1366/us-mass-incarceration.git."
date: today
date-format: long
abstract: "This social science research focuses on the impact of prisons on crime rates and socioeconomic disparities. However, the penal institutions are often disregarded, creating a significant gap in understanding its true effect. This paper takes a look at the prison, their function in rehabilitation efforts, their role as setting for violence, healthcare provision, and the isolation experienced in solitary confinement. Recent studies indicate that fewer inmates are involved in programs now compared to the 1980’s, and prisoners face more violence, sickness, and isolation. These conditions question if prisons are really treating people with dignity and respect, and how these acts will affect people who recently joined the society again. "
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false
install.packages("haven")  # Install the haven package
install.packages("openxlsx")
library(openxlsx)
library(haven)  # Load the haven package
library(tidyverse)
library(palmerpenguins)
library(dplyr)
```


# Introduction

This paper explores how prisons impact crime and inequality. Prisons are often overlooked compared to other institutions such as schools or hospitals. We are focusing on the US, where the concept of “mass incarceration” is a big issue, in other words there are a lot of people in prison, especially Black men with limited education. This mostly happens due to strict laws against Black men and inequality that rise upon the issue. 
Researchers have studied incarceration in various angles, examining its effects on how prisons affect crime rates, labor markets, health outcomes, and family dynamics. Despite debates over rehabilitation, it is still hard for them to get jobs and be accepted in society. 
This paper takes a unique perspective, where we view US penal institutions as “total institutions” where individuals face constricted control and minimal autonomy. We are exploring key issues such as overcrowding, violence, health challenges, and the harsh realities of solitary confinement. By understanding what happens inside prisons, we can gain a deeper understanding of the problems of mass incarceration and work towards making things better. 
→ We can add details after we decide what data and model we are going to use (Ex. Rate has increased 80% over 1990 to 2020) 

The remainder of this paper is structured as follows. @sec-data....



# Data {#sec-data}

##Source
The paper used for replication is "Inside the Box: Safety, Health, and Isolation in Prison," which mainly analyzes the impact of prisons on safety and health, and specifically includes data from the new coronavirus pandemic.

Sourcebook of Criminal Justice Statistics, Bureau of Justice Statistics Report, Jail Inmates in 2018, U.S. Population FRED Data, World Prison Population Data, and Western B. and Pettit B data

## Methodology
All data are not obtained directly through surveys or sampling statistics; rather, they are derived through meticulous processing and calculation based on pre-existing datasets.

 mass incarceration.xlsx
 
 incarceration 1925-2019
 

## Features
mass incarceration.xlsx
 
 incarceration 1925-2019
 Year:1925-2019
 Prison: integer number
 Prison rate per(100k) : easy to read and compare
 Jail
 Total
 Population
 Total Rate
 
 world incarceration rates
 rate
 rate18
 
 cumulative risk
 race :w(white) b(black) Lack of data on other ethnic minorities

 education
 cohort
 risk

COVID-19 Cases in State and Federal Prison Systems.csv：
Prison System
Incarcerated Tested
Incarcerated Positive,
Incarcerated Deaths,
Staff Positive,
Staff Deaths,
Incarcerated Case rate per 1,000
Scrape Date
Staff Case rate per 1,000
state

statepop.csv:
sate
abbreviation

all-states-history.csv:

## Measurement:
Enrollment in Drug, Education, Job Training Programs, and Work Assignment, State Prisoners, by Region
Original data comes from two prison questionnaires
For example, the sample for the 2004 survey was drawn from two different documents. The primary archive includes a list of 1,549 state prisons from the June 30, 2000, BJS 2000 Census of State and Federal Correctional Facilities. The secondary archive includes 36 prisons open between June 30, 2000, and April 1, 2003. The sampling design required a stratified two-stage selection process. In the initial phase, 14 male and 7 female facilities were identified based on the gender ratio within prisons. The remaining facilities are divided into 16 levels based on geographic region and the male and female population within each prison. The weighting procedure involves assigning each inmate a base weight and three adjustment factors to obtain the final weight for the survey. Data was collected through face-to-face interviews with prisoners using computer-assisted personal interviewing techniques.

Cumulative COVID-19 Case Rates among Those in Prison and General Population, by State: March 2020 to January 2021

# Result
## Over trend
@fig-over
```{r fig.height=10, fig.width=6 }
#| label: fig-over
#| fig-cap: US Incarceration, 1925-2018
#| echo: false
#| warning: false
#| message: false

library(openxlsx)

file_path <- here::here("inputs/data/mass incarceration.xlsx")

# Read the Excel file
x0 <- read.xlsx(file_path, sheet = 1)
par(mfrow=c(3,1))
par(fig=c(.05,.95, 2/3-.02, 1))
plot(x0$Year, x0$Prison.Rate.per.100k, type="l", col="blue",
     xlim=c(1920, 2020), ylim=c(0, 800),
     xlab="", ylab="Incarceration Rate (per 100,000)", lty=1, lwd=2)
title(" US Incarceration, 1925-2018")
lines(x0$Year, x0$TotalRate, lty=2, col="red", lwd=2)
legend(1925, 770, c("Prison and jail","Prison only"), lwd=2,
       lty=c(2,1), col=c("red","blue"), bty="n")
abline(h=seq(0, 800, 200), v=seq(1920,2020,20), lty=3, col="gray")

```


@fig-country
```{r fig.height=8, fig.width=10 }
#| label: fig-country
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false


data <-  read.csv(file = here::here("outputs/data/clean_country_data.csv"))

data <- data[order(-data$prison_population_rate), ]

# Create the bar plot
plot <- ggplot(data, aes(x =prison_population_rate, y = country)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  theme(axis.text.x = element_text(angle = 0, hjust = 1, vjust = 0.5)) +  # Rotate x-axis labels
  labs(x = "Prison Population Rate", y = "country") +  # Add axis labels
  ggtitle("Prison Population Rate by Country ")  # Add title

print(plot)

```

Some of our data is of penguins (@fig-bill), from @palmerpenguins.
```{r fig.height=8, fig.width=10 }
#| label: fig-planes
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false



# Reading data
# Read CSV file using here::here() for file path and header = TRUE
x <- read.csv(file = here::here("inputs/data/all-states-history.csv"), header = TRUE)

x1218 <- x[x$date == "2020-12-18",]   # Subset data for 12/18/2020

# Ensure 'pop' column name is provided correctly in read_csv
pop <- read.csv(file = here::here("inputs/data/statepop.csv"), header = FALSE)

# Ensure 'pop' is extracted correctly from 'pop' data frame
ind <- match(x1218$state, pop[,2])

# Assign state population to x1218$pop
x1218$pop <- pop[ind,3]

# Calculate case rate for x1218
x1218$ccr <- x1218$positive / (x1218$pop * 1e6)
x1 <- read.csv(file = here::here("inputs/data/COVID-19 Cases in State and Federal Prison Systems.csv"),
               header=T) 

x1 <- lapply(x1, function(i) { sub(",", "", i) })                    # data cleaning
x1 <- lapply(x1, function(i) { sub("NR", NA, i) })
x1[names(x1)[c(2:7,9)]]  <- lapply(x1[names(x1)[c(2:7,9)]], as.numeric)
x1$incpop <- x1$Incarcerated.Positive/x1$Incarcerated.Case.rate.per.1.000

ind <- match(x1218$state, x1$Prison.System)                           # matching states
ccr <- data.frame(pop=1000*x1218$ccr,
                  prisn=x1$Incarcerated.Case.rate.per.1.000[ind],
                  state=x1$state[ind])                               # case rate dataframe
ccr <- ccr[complete.cases(ccr),]

o1 <- order(ccr[,2])
n1 <- length(o1)



par(fig=c(.1,1,0,1))
plot(ccr[o1,2], 1:n1, pch="", xlim=c(0,800), xlab="", ylab="", yaxt='n')
abline(h=1:n1, lty=5, col="gray")
axis(1)
points(ccr[o1,1], 1:n1, pch=17, col="blue")
points(ccr[o1,2], 1:n1, pch=16, col="red")
mtext(ccr$state[o1], side=2, at=1:n1, las=1, line=.5, cex=.75)
legend(450, 7, c("Prison","General population"), pch=c(16, 17),
       col=c("red","blue"), bty="n", cex=1.1)

```

```{r fig.height=8, fig.width=10}
#| label: fig-bills2
#| fig-cap: Bills of penguins
#| echo: false

x <- read.csv(file = here::here("inputs/data/all-states-history.csv"), header = TRUE)

x1218 <- x[x$date == "2020-12-18",]   # Subset data for 12/18/2020

# Ensure 'pop' column name is provided correctly in read_csv
pop <- read.csv(file = here::here("inputs/data/statepop.csv"), header = FALSE)

# Ensure 'pop' is extracted correctly from 'pop' data frame
ind <- match(x1218$state, pop[,2])

# Assign state population to x1218$pop
x1218$pop <- pop[ind,3]

# Calculate case rate for x1218
x1218$ccr <- x1218$positive / (x1218$pop * 1e6)
x2 <- read.csv(file = here::here("inputs/data/COVID-19 Cases in State and Federal Prison Systems.csv"), header = TRUE) 

# Data cleaning
x2 <- lapply(x2, function(i) { gsub(",", "", i) })  # Remove commas
x2 <- lapply(x2, function(i) { gsub("NR", NA, i) })  # Replace "NR" with NA
x2[names(x2)[c(2:7, 9)]] <- lapply(x2[names(x2)[c(2:7, 9)]], as.numeric)  # Convert selected columns to numeric
x2$incpop <- x2$Staff.Positive / x2$Staff.Case.rate.per.1.000

# Match states
ind <- match(x1218$state, x2$Prison.System)

# Create case rate dataframe
ccr <- data.frame(pop = 1000 * x1218$ccr,
                  prisn = x2$Staff.Case.rate.per.1.000[ind],
                  state = x2$state[ind])

# Remove rows with NAs
ccr <- ccr[complete.cases(ccr),]

# Plotting
o1 <- order(ccr[, 2])
n1 <- length(o1)


par(fig=c(.1,1,0,1))

plot(ccr[o1, 2], 1:n1, pch="", xlim=c(0, 800), xlab="", ylab="", yaxt='n')
abline(h=1:n1, lty=5, col="gray")
axis(1)
points(ccr[o1, 1], 1:n1, pch=17, col="blue")
points(ccr[o1, 2], 1:n1, pch=16, col="green")
mtext(ccr$state[o1], side=2, at=1:n1, las=1, line=.5, cex=.75)
legend(450, 7, c("Staff", "General population"), pch=c(16, 17),
       col=c("green", "blue"), bty="n", cex=1.1)


```

```{r }
#| label: fig-plane
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false

data_1 <- read_dta('../../inputs/data/spi86to16.dta')

x <- data_1[data_1$admit==0,] 

drugev  <- data.matrix(x %>% group_by(region, year) %>% summarize(weighted.mean(drugev, wt, na.rm=T)))
drugev  <- drugev[!is.nan(drugev[,3]),]
vocev   <- data.matrix(x %>% group_by(region, year) %>% summarize(weighted.mean(vocev, wt, na.rm=T)))
vocev   <- data.matrix(vocev[!is.nan(vocev[,3]),])
work    <- data.matrix(x %>% group_by(region, year) %>% summarize(weighted.mean(work, wt, na.rm=T)))
work    <- data.matrix(work[!is.nan(work[,3]),])
edev    <- data.matrix(x %>% group_by(region, year) %>% summarize(weighted.mean(edev, wt, na.rm=T)))
edev    <- data.matrix(edev[!is.nan(edev[,3]),])

dimnames(drugev) <- dimnames(vocev) <- dimnames(work) <- dimnames(edev) <-
  list(NULL, c("region","year","xbar"))

par(mfrow=c(1,4))
par(fig=c(0,.29, 0,1))
plot(drugev[drugev[,"region"]==1,"year"],
     drugev[drugev[,"region"]==1,"xbar"]*100,
     type="b", pch=16, main="Drug Program",
     xlim=c(1986, 2016), ylim=c(0,80), col="skyblue2",
     axes=F, ylab="Percent", xlab="")
axis(1)
axis(2)
lines(drugev[drugev[,"region"]==2,"year"], drugev[drugev[,"region"]==2,"xbar"]*100,
      type="b", pch=17, col="dodgerblue")
lines(drugev[drugev[,"region"]==3,"year"], drugev[drugev[,"region"]==3,"xbar"]*100,
      type="b", pch=18, col="red")
lines(drugev[drugev[,"region"]==4,"year"], drugev[drugev[,"region"]==4,"xbar"]*100,
      type="b", pch=19, col="blue")
legend(1986, 80, c("Northeast","Midwest","South","West"),
       pch=16:19, col=c("skyblue2", "dodgerblue", "red","blue"),
       lty=1, bty="n", cex=1.1)
abline(v=seq(1985, 2015, 10), h=seq(0,80, 20), col="gray",lty=3)
par(new=T)
par(fig=c(.237,.527, 0,1))
plot(edev[edev[,"region"]==1,"year"],
     edev[edev[,"region"]==1,"xbar"]*100, type="b", pch=16, main="Education",
     xlim=c(1986, 2016), ylim=c(0,80), col="skyblue2",
     axes=F, ylab="", xlab="")
axis(1)
lines(edev[edev[,"region"]==2,"year"], edev[edev[,"region"]==2,"xbar"]*100, type="b", pch=17, col="dodgerblue")
lines(edev[edev[,"region"]==3,"year"], edev[edev[,"region"]==3,"xbar"]*100, type="b", pch=18, col="red")
lines(edev[edev[,"region"]==4,"year"], edev[edev[,"region"]==4,"xbar"]*100, type="b", pch=19, col="blue")
abline(v=seq(1985, 2015, 10), h=seq(0,80, 20), col="gray",lty=3)
par(new=T)
par(fig=c(.473,.763, 0,1))
plot(vocev[vocev[,"region"]==1,"year"],
     vocev[vocev[,"region"]==1,"xbar"]*100, type="b", pch=16, main="Job Training",
     xlim=c(1986, 2016), ylim=c(0,80), col="skyblue2",
     axes=F, ylab="", xlab="")
axis(1)
lines(vocev[vocev[,"region"]==2,"year"], vocev[vocev[,"region"]==2,"xbar"]*100, type="b", pch=17, col="dodgerblue")
lines(vocev[vocev[,"region"]==3,"year"], vocev[vocev[,"region"]==3,"xbar"]*100, type="b", pch=18, col="red")
lines(vocev[vocev[,"region"]==4,"year"], vocev[vocev[,"region"]==4,"xbar"]*100, type="b", pch=19, col="blue")
abline(v=seq(1985, 2015, 10), h=seq(0,80, 20), col="gray",lty=3)
par(new=T)
par(fig=c(.71,1.0, 0,1))
plot(work[work[,"region"]==1,"year"],
     work[work[,"region"]==1,"xbar"]*100, type="b", pch=16, main="Work",
     xlim=c(1986, 2016), ylim=c(0,80), col="skyblue2",
     axes=F, ylab="", xlab="")
axis(1)
lines(work[work[,"region"]==2,"year"], work[work[,"region"]==2,"xbar"]*100, type="b", pch=17, col="dodgerblue")
lines(work[work[,"region"]==3,"year"], work[work[,"region"]==3,"xbar"]*100, type="b", pch=18, col="red")
lines(work[work[,"region"]==4,"year"], work[work[,"region"]==4,"xbar"]*100, type="b", pch=19, col="blue")
abline(v=seq(1985, 2015, 10), h=seq(0,80, 20), col="gray",lty=3)



```



And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)




Talk way more about it. 



# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

Our results are summarized in @tbl-modelresults.







# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 


## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...






\newpage


# References


