---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - First author
  - Another author
thanks: "Code and data are available at: LINK."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(palmerpenguins)
library(readr)
```


# Introduction

You can and should cross-reference sections and sub-sections. 

The remainder of this paper is structured as follows. 



# Data 
## Source

## Methodology
All data are not obtained directly through surveys/interviews, but are processed and calculated based on existing data.
 
 mass incarceration.xlsx
 
 incarceration 1925-2019
 

## Features
mass incarceration.xlsx
 
 incarceration 1925-2019
 year :1925-2019
 Prison :integer number
 Prison rate per(100k) easy to read and compare
 Jail
 Total
 Population
 Total Rate
 
 world incarceration rates
 rate
 rate18
 
 cumulative risk
 race :w(white) b(black)
 education
 cohort
 risk
 








Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)

```{r fig.height=8, fig.width=10 }
#| label: fig-planes
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false



# Reading data
# Read CSV file using here::here() for file path and header = TRUE
x <- read.csv(file = here::here("inputs/data/all-states-history.csv"), header = TRUE)

x1218 <- x[x$date == "2020-12-18",]   # Subset data for 12/18/2020

# Ensure 'pop' column name is provided correctly in read_csv
pop <- read.csv(file = here::here("inputs/data/statepop.csv"), header = FALSE)

# Ensure 'pop' is extracted correctly from 'pop' data frame
ind <- match(x1218$state, pop[,2])

# Assign state population to x1218$pop
x1218$pop <- pop[ind,3]

# Calculate case rate for x1218
x1218$ccr <- x1218$positive / (x1218$pop * 1e6)
x1 <- read.csv(file = here::here("inputs/data/COVID-19 Cases in State and Federal Prison Systems.csv"),
               header=T) 

x1 <- lapply(x1, function(i) { sub(",", "", i) })                    # data cleaning
x1 <- lapply(x1, function(i) { sub("NR", NA, i) })
x1[names(x1)[c(2:7,9)]]  <- lapply(x1[names(x1)[c(2:7,9)]], as.numeric)
x1$incpop <- x1$Incarcerated.Positive/x1$Incarcerated.Case.rate.per.1.000

ind <- match(x1218$state, x1$Prison.System)                           # matching states
ccr <- data.frame(pop=1000*x1218$ccr,
                  prisn=x1$Incarcerated.Case.rate.per.1.000[ind],
                  state=x1$state[ind])                               # case rate dataframe
ccr <- ccr[complete.cases(ccr),]

o1 <- order(ccr[,2])
n1 <- length(o1)



par(fig=c(.1,1,0,1))
plot(ccr[o1,2], 1:n1, pch="", xlim=c(0,800), xlab="", ylab="", yaxt='n')
abline(h=1:n1, lty=5, col="gray")
axis(1)
points(ccr[o1,1], 1:n1, pch=17, col="blue")
points(ccr[o1,2], 1:n1, pch=16, col="red")
mtext(ccr$state[o1], side=2, at=1:n1, las=1, line=.5, cex=.75)
legend(450, 7, c("Prison","General population"), pch=c(16, 17),
       col=c("red","blue"), bty="n", cex=1.1)

  
```

Talk way more about it. 
(@fig-bills2)

```{r fig.height=8, fig.width=10}
#| label: fig-bills2
#| fig-cap: Bills of penguins
#| echo: false

x <- read.csv(file = here::here("inputs/data/all-states-history.csv"), header = TRUE)

x1218 <- x[x$date == "2020-12-18",]   # Subset data for 12/18/2020

# Ensure 'pop' column name is provided correctly in read_csv
pop <- read.csv(file = here::here("inputs/data/statepop.csv"), header = FALSE)

# Ensure 'pop' is extracted correctly from 'pop' data frame
ind <- match(x1218$state, pop[,2])

# Assign state population to x1218$pop
x1218$pop <- pop[ind,3]

# Calculate case rate for x1218
x1218$ccr <- x1218$positive / (x1218$pop * 1e6)
x2 <- read.csv(file = here::here("inputs/data/COVID-19 Cases in State and Federal Prison Systems.csv"), header = TRUE) 

# Data cleaning
x2 <- lapply(x2, function(i) { gsub(",", "", i) })  # Remove commas
x2 <- lapply(x2, function(i) { gsub("NR", NA, i) })  # Replace "NR" with NA
x2[names(x2)[c(2:7, 9)]] <- lapply(x2[names(x2)[c(2:7, 9)]], as.numeric)  # Convert selected columns to numeric
x2$incpop <- x2$Staff.Positive / x2$Staff.Case.rate.per.1.000

# Match states
ind <- match(x1218$state, x2$Prison.System)

# Create case rate dataframe
ccr <- data.frame(pop = 1000 * x1218$ccr,
                  prisn = x2$Staff.Case.rate.per.1.000[ind],
                  state = x2$state[ind])

# Remove rows with NAs
ccr <- ccr[complete.cases(ccr),]

# Plotting
o1 <- order(ccr[, 2])
n1 <- length(o1)


par(fig=c(.1,1,0,1))

plot(ccr[o1, 2], 1:n1, pch="", xlim=c(0, 800), xlab="", ylab="", yaxt='n')
abline(h=1:n1, lty=5, col="gray")
axis(1)
points(ccr[o1, 1], 1:n1, pch=17, col="blue")
points(ccr[o1, 2], 1:n1, pch=16, col="green")
mtext(ccr$state[o1], side=2, at=1:n1, las=1, line=.5, cex=.75)
legend(450, 7, c("Staff", "General population"), pch=c(16, 17),
       col=c("green", "blue"), bty="n", cex=1.1)


```



# Results

Our results are summarized in 







# Discussion

## First discussion point 

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details 

## Posterior predictive check






## Diagnostics







\newpage


# References


